* Microsoft COBOL Version 4.5        L2.4 revision 002 30-Oct-13 22:32 Page   1
*                                        E.CBL
* Options: LIST(E.LST) ASMLIST(E.GRP)
     1 IDENTIFICATION DIVISION.
     2
     3 PROGRAM-ID.   EX06.
     4 AUTHOR.       LEANDRO & EDEL.
     5 INSTALLATION. FATEC-SP.
     6 DATE-WRITTEN. 26/10/13.
     7 DATE-COMPILED. 30-Oct-13 22:32.
     8 SECURITY.
     9
    10 ENVIRONMENT DIVISION.
    11
    12 CONFIGURATION SECTION.
    13 SOURCE-COMPUTER. IBM-PC.
    14 OBJECT-COMPUTER. IBM-PC.
    15 SPECIAL-NAMES.   DECIMAL-POINT IS COMMA.
    16
    17 INPUT-OUTPUT SECTION.
    18 FILE-CONTROL.
    19 SELECT CADVEND ASSIGN TO DISK ORGANIZATION IS LINE SEQUENTIAL.
    20 SELECT REL-PAG ASSIGN TO DISK.
    21 SELECT TRAB    ASSIGN TO DISK.
    22
    23 DATA DIVISION.
    24
    25 FILE SECTION.
    26 FD CADVEND
    27    LABEL RECORD ARE STANDARD VALUE OF FILE-ID IS "CADVEND.DAT".
    28
    29 01 REG-ENT.
    30    02 COD-DEP-ENT   PIC X(01).
    31    02 COD-SEC-ENT   PIC X(01).
    32    02 COD-VEND-ENT  PIC 9(05).
    33    02 NOME-ENT      PIC X(20).
    34    02 VAL-VEND-ENT  PIC 9(07)V99.
    35    02 SAL-FIXO-ENT  PIC 9(07)V99.
    36    02 DENCONTO-ENT  PIC 9(05)V99.
    37
    38 FD REL-PAG
    39    LABEL RECORD IS OMITTED.
    40
    41 01 REG-ATR          PIC X(80).
    42
    43 SD TRAB.
    44
    45 01 REG-TRAB.
    46    02 COD-DEP-TRAB  PIC X(01).
    47    02 COD-SEC-TRAB  PIC X(01).
    48    02 COD-VEND-TRAB PIC 9(05).
    49    02 NOME-TRAB     PIC X(20).
    50    02 VAL-VEND-TRAB PIC 9(07)V99.
    51    02 SAL-FIXO-TRAB PIC 9(07)V99.
    52    02 DENCONTO-TRAB PIC 9(05)V99.
    53
    54 WORKING-STORAGE SECTION.
    55
    56 77 FIM-ARQ          PIC 9(01) VALUE 0.
    57 77 CT-PAG           PIC 9(03) VALUE 0.
* Microsoft COBOL Version 4.5        L2.4 revision 002 30-Oct-13 22:32 Page   2
*                                        E.CBL
    58 77 CT-LIN           PIC 9(02) VALUE 41.
    59 77 COMISSAO         PIC 9(07)V99.
    60 77 SAL-BRUTO        PIC 9(07)V99.
    61 77 SAL-LIQUIDO      PIC 9(07)V99.
    62 77 TOTAL-SAL-SEC    PIC 9(09)V99.
    63 77 TOTAL-SAL-DEP    PIC 9(12)V99.
    64 77 COD-DEP-ATUAL    PIC X(01).
    65 77 COD-SEC-ATUAL    PIC X(01).
    66 77 FLAG-01          PIC 9(01) VALUE 1.
    67
    68 01 CAB-01.
    69    02 FILLER    PIC X(29) VALUE SPACES.
    70    02 FILLER    PIC X(22) VALUE "RELATÓRIO DE PAGAMENTO".
    71    02 FILLER    PIC X(19) VALUE SPACES.
    72    02 FILLER    PIC X(05) VALUE "PAG. ".
    73    02 VAR-PAG   PIC ZZ9.
    74    02 FILLER    PIC X(18) VALUE SPACES.
    75
    76 01 CAB-02.
    77    02 FILLER       PIC X(01) VALUE SPACES.
    78    02 FILLER       PIC X(16) VALUE "DEPARTAMENTO  = ".
    79    02 COD-DEP-REL  PIC X(01).
    80    02 FILLER       PIC X(62) VALUE SPACES.
    81
    82 01 CAB-03.
    83    02 FILLER       PIC X(01) VALUE SPACES.
    84    02 FILLER       PIC X(16) VALUE "SEÇÃO         = ".
    85    02 COD-SEC-REL  PIC X(01).
    86    02 FILLER       PIC X(62) VALUE SPACES.
    87
    88 01 CAB-04.
    89    02 FILLER       PIC X(06) VALUE "CODIGO".
    90    02 FILLER       PIC X(02) VALUE SPACES.
    91    02 FILLER       PIC X(04) VALUE "NOME".
    92    02 FILLER       PIC X(16) VALUE SPACES.
    93    02 FILLER       PIC X(08) VALUE "SAL.FIXO".
    94    02 FILLER       PIC X(03) VALUE SPACES.
    95    02 FILLER       PIC X(08) VALUE "COMISSAO".
    96    02 FILLER       PIC X(02) VALUE SPACES.
    97    02 FILLER       PIC X(10) VALUE "SAL.BRUTO".
    98    02 FILLER       PIC X(01) VALUE SPACES.
    99    02 FILLER       PIC X(08) VALUE "DESCONTO".
   100    02 FILLER       PIC X(01) VALUE SPACES.
   101    02 FILLER       PIC X(11) VALUE "SAL.LIQUIDO".
   102
   103 01 CAB-05.
   104    02 FILLER PIC X(28) VALUE
   105              "TOTAL DE SALÁRIOS DA SEÇÃO: ".
   106    02 TOTAL-SAL-SEC-REL PIC ZZZ.ZZZ.ZZ9,99.
   107    02 FILLER PIC X(38) VALUE SPACES.
   108
   109 01 CAB-06.
   110    02 FILLER PIC X(35) VALUE
   111              "TOTAL DE SALÁRIOS DO DEPARTAMENTO: ".
   112    02 TOTAL-SAL-DEP-REL PIC ZZZ.ZZZ.ZZZ.ZZ9,99.
   113    02 FILLER PIC X(27) VALUE SPACES.
   114
   115 01 DETALHE.
* Microsoft COBOL Version 4.5        L2.4 revision 002 30-Oct-13 22:32 Page   3
*                                        E.CBL
   116    02 COD-VEND-REL PIC 9(05).
   117    02 FILLER       PIC X(01) VALUE SPACES.
   118    02 NOME-REL     PIC X(20).
   119    02 FILLER       PIC X(01) VALUE SPACES.
   120    02 SAL-FIXO-REL PIC ZZZZZZ9,99.
   121    02 FILLER       PIC X(01) VALUE SPACES.
   122    02 COMISSAO-REL PIC ZZZZZZ9,99.
   123    02 FILLER       PIC X(01) VALUE SPACES.
   124    02 SAL-BRUT-REL PIC ZZZZZZ9,99.
   125    02 FILLER       PIC X(01) VALUE SPACES.
   126    02 DESCONTO-REL PIC ZZZZ9,99.
   127    02 FILLER       PIC X(01) VALUE SPACES.
   128    02 SAL-LIQU-REL PIC ZZZZZZ9,99.
   129    02 FILLER       PIC X(01) VALUE SPACES.
   130
   131 PROCEDURE DIVISION.
   132
   133 PROGRAM06.
   134
   135 SORT TRAB
   136      ASCENDING COD-DEP-TRAB
   137      ASCENDING COD-SEC-TRAB
   138      USING CADVEND
   139      OUTPUT PROCEDURE GERA-REL.
   140
   141 STOP RUN.
   142
   143 INICIO.
   144        OPEN INPUT CADVEND OUTPUT REL-PAG.
   145        PERFORM VERIFICA-FIM.
   146
   147 VERIFICA-FIM.
   148        RETURN TRAB AT END MOVE 1 TO FIM-ARQ.
   149
   150 FIM.
   151        CLOSE CADVEND REL-PAG.
   152
   153 PRINCIPAL.
   154        IF COD-DEP-ATUAL NOT EQUAL COD-DEP-TRAB
   155
   156           IF CT-PAG NOT EQUAL 0
   157               PERFORM CABECALHO-SECAO-DEPARTAMENTO
   158           END-IF
   159
   160           MOVE 0 TO TOTAL-SAL-DEP
   161
   162           MOVE COD-DEP-TRAB  TO COD-DEP-ATUAL
   163           MOVE COD-DEP-ATUAL TO COD-DEP-REL
   164
   165           PERFORM AVANCA-PAGINA
   166           PERFORM CABECALHO-DEPARTAMENTO
   167
   168           MOVE COD-SEC-TRAB TO COD-SEC-REL
   169           WRITE REG-ATR FROM CAB-03 AFTER ADVANCING 1 LINE
   170           MOVE 1 TO FLAG-01
   171
   172        END-IF
   173
* Microsoft COBOL Version 4.5        L2.4 revision 002 30-Oct-13 22:32 Page   4
*                                        E.CBL
   174        IF COD-SEC-ATUAL NOT EQUAL COD-SEC-TRAB
   175
   176           MOVE COD-SEC-TRAB  TO COD-SEC-ATUAL
   177           MOVE COD-SEC-ATUAL TO COD-SEC-REL
   178
   179           IF FLAG-01 NOT EQUAL 1
   180              MOVE TOTAL-SAL-SEC TO TOTAL-SAL-SEC-REL
   181              WRITE REG-ATR FROM CAB-05 AFTER ADVANCING 2 LINES
   182
   183              WRITE REG-ATR FROM CAB-03 AFTER ADVANCING 2 LINES
   184           END-IF
   185
   186           MOVE 0 TO FLAG-01
   187           MOVE 0 TO TOTAL-SAL-SEC
   188
   189           WRITE REG-ATR FROM CAB-04 AFTER ADVANCING 2 LINES
   190
   191        END-IF
   192
   193        PERFORM IMPRESSAO.
   194        PERFORM VERIFICA-FIM.
   195
   196 IMPRESSAO.
   197        IF CT-LIN GREATER THAN 40
   198           PERFORM AVANCA-PAGINA
   199        END-IF
   200        PERFORM IMPDET.
   201
   202 IMPDET.
   203        PERFORM CALCULA-COMISSAO.
   204        ADD SAL-FIXO-TRAB COMISSAO GIVING SAL-BRUTO.
   205        SUBTRACT DENCONTO-TRAB FROM SAL-BRUTO GIVING SAL-LIQUIDO.
   206
   207        MOVE COD-VEND-TRAB TO COD-VEND-REL.
   208        MOVE NOME-TRAB     TO NOME-REL.
   209        MOVE SAL-FIXO-TRAB TO SAL-FIXO-REL.
   210        MOVE COMISSAO      TO COMISSAO-REL.
   211        MOVE SAL-BRUTO     TO SAL-BRUT-REL.
   212        MOVE SAL-LIQUIDO   TO SAL-LIQU-REL.
   213        MOVE DENCONTO-TRAB TO DESCONTO-REL.
   214
   215        WRITE REG-ATR FROM DETALHE AFTER ADVANCING 1 LINE.
   216
   217        ADD SAL-LIQUIDO    TO TOTAL-SAL-DEP   TOTAL-SAL-SEC.
   218
   219 AVANCA-PAGINA.
   220        ADD  1 TO CT-PAG.
   221        MOVE 0 TO CT-LIN.
   222        MOVE SPACES TO REG-ATR.
   223        WRITE REG-ATR AFTER ADVANCING PAGE.
   224
   225 CABECALHO-SECAO-DEPARTAMENTO.
   226              MOVE TOTAL-SAL-SEC TO TOTAL-SAL-SEC-REL.
   227              WRITE REG-ATR FROM CAB-05 AFTER ADVANCING 2 LINES.
   228              MOVE TOTAL-SAL-DEP TO TOTAL-SAL-DEP-REL.
   229              WRITE REG-ATR FROM CAB-06 AFTER ADVANCING 1 LINE.
   230
   231 CALCULA-COMISSAO.
* Microsoft COBOL Version 4.5        L2.4 revision 002 30-Oct-13 22:32 Page   5
*                                        E.CBL
   232        IF VAL-VEND-TRAB NOT GREATER THAN 1000
   233           MULTIPLY VAL-VEND-TRAB BY 0,05 GIVING COMISSAO
   234        ELSE
   235           IF VAL-VEND-TRAB NOT GREATER THAN 3000
   236              MULTIPLY VAL-VEND-TRAB BY 0,10 GIVING COMISSAO
   237           ELSE
   238              MULTIPLY VAL-VEND-TRAB BY 0,15 GIVING COMISSAO
   239           END-IF
   240        END-IF.
   241
   242 CABECALHO-DEPARTAMENTO.
   243        MOVE CT-PAG TO VAR-PAG.
   244        WRITE REG-ATR FROM CAB-01 AFTER ADVANCING 1 LINE.
   245        WRITE REG-ATR FROM CAB-02 AFTER ADVANCING 2 LINES.
   246
   247 GERA-REL SECTION.
   248        PERFORM INICIO.
   249        PERFORM PRINCIPAL UNTIL FIM-ARQ EQUAL 1.
   250        PERFORM CABECALHO-SECAO-DEPARTAMENTO.
   251        PERFORM FIM.
* Microsoft COBOL Version 4.5        L2.4 revision 002
* (C)Copyright Microsoft Corp 1984, 1991       URN AXUPA/MS0/000000
*                                              REF GNB-024050002A7
*
* Total Messages:     0
* Data:        2036     Code:        1248     Dictionary:        3376
