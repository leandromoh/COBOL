* Microsoft COBOL Version 4.5        L2.4 revision 002 26-Sep-13 13:48 Page   1
*                                       EX06.CBL
* Options: LIST(EX06.LST) ASMLIST(EX06.GRP)
     1 IDENTIFICATION DIVISION.
     2
     3 PROGRAM-ID. EX06.
     4 AUTHOR. LEANDRO FERNANDES & EDEL CORADI.
     5 INSTALLATION. FATEC-SP.
     6 DATE-WRITTEN. 15/09/2013.
     7 DATE-COMPILED. 26-Sep-13 13:48.
     8 SECURITY.
     9
    10 ENVIRONMENT DIVISION.
    11
    12 CONFIGURATION SECTION.
    13 SOURCE-COMPUTER. IBM-PC.
    14 OBJECT-COMPUTER. IBM-PC.
    15 SPECIAL-NAMES. DECIMAL-POINT IS COMMA.
    16
    17 INPUT-OUTPUT SECTION.
    18 FILE-CONTROL.
    19 SELECT CADCLI  ASSIGN TO DISK ORGANIZATION IS LINE SEQUENTIAL.
    20 SELECT CADOK   ASSIGN TO DISK ORGANIZATION IS LINE SEQUENTIAL.
    21 SELECT RELOCOR ASSIGN TO DISK.
    22
    23 DATA DIVISION.
    24
    25 FILE SECTION.
    26 FD CADCLI
    27    LABEL         RECORD         ARE         STANDARD
    28    VALUE       OF FILE-ID       IS        "CADCLI.DAT".
    29
    30 01 REGCLI.
    31    02 CODIGO     PIC 9(03).
    32    02 CPF.
    33       03 DIG-1   PIC 9(01).
    34       03 DIG-2   PIC 9(01).
    35       03 DIG-3   PIC 9(01).
    36       03 DIG-4   PIC 9(01).
    37       03 DIG-5   PIC 9(01).
    38       03 DIG-6   PIC 9(01).
    39       03 DIG-7   PIC 9(01).
    40       03 DIG-8   PIC 9(01).
    41       03 DIG-9   PIC 9(01).
    42       03 DIG-V1   PIC 9(01).
    43       03 DIG-V2   PIC 9(01).
    44
    45    02 NOME       PIC X(30).
    46
    47    02 ESTADO     PIC X(02).
    48       88 ESTADO-VALIDO VALUE
    49          "AC" "AL" "AP" "AM" "BA" "CE" "DF" "ES" "GO"
    50          "MA" "MT" "MS" "MG" "PA" "PB" "PR" "PE" "PI"
    51          "RJ" "RN" "RS" "RO" "RR" "SC" "SP" "SE" "TO".
    52
    53    02 CIDADE     PIC X(30).
    54    02 EMAIL      PIC X(30).
    55    02 TELEFONE   PIC 9(10).
    56
    57    02 DATA-ENT.
* Microsoft COBOL Version 4.5        L2.4 revision 002 26-Sep-13 13:48 Page   2
*                                       EX06.CBL
    58       03 DD  PIC 9(02).
    59          88 DIA-VALIDO VALUE 1 THRU 31.
    60
    61       03 MM  PIC 9(02).
    62          88 MES-VALIDO VALUE 1 THRU 12.
    63          88 MES-COM-30-DIAS VALUE 4 6 9 11.
    64          88 MES-COM-31-DIAS VALUE 1 3 5 7 8 10 12.
    65
    66       03 AA  PIC 9(04).
    67
    68 FD CADOK
    69    LABEL         RECORD         ARE         STANDARD
    70    VALUE       OF FILE-ID       IS        "CADOK.DAT".
    71
    72 01 REGOK.
    73    02 CPF-OK        PIC 9(11).
    74    02 NOME-OK       PIC X(30).
    75    02 ESTADO-OK     PIC X(02).
    76    02 CIDADE-OK     PIC X(30).
    77    02 EMAIL-OK      PIC X(30).
    78    02 TELEFONE-OK   PIC 9(10).
    79    02 DATA-OK.
    80       03 DD-OK  PIC 9(02).
    81       03 MM-OK  PIC 9(02).
    82       03 AA-OK  PIC 9(04).
    83
    84 FD  RELOCOR
    85     LABEL        RECORD         IS          OMITTED.
    86
    87 01  REG-ATR                  PIC X(80).
    88
    89 WORKING-STORAGE SECTION.
    90
    91 77 FIM-ARQ       PIC 9(01) VALUE 0.
    92 77 CT-LIN        PIC 9(02) VALUE 41.
    93 77 ERRO          PIC 9(01) VALUE 0.
    94 77 ERRO-NOME     PIC 9(01) VALUE 0.
    95 77 ERRO-CPF      PIC 9(01) VALUE 0.
    96 77 ERRO-ESTADO   PIC 9(01) VALUE 0.
    97 77 ERRO-CIDADE   PIC 9(01) VALUE 0.
    98 77 ERRO-EMAIL    PIC 9(01) VALUE 0.
    99 77 ERRO-DATA     PIC 9(01) VALUE 0.
   100 77 RESTO         PIC 9(03).
   101 77 DIG-V1-CORRET PIC 9(03).
   102 77 DIG-V2-CORRET PIC 9(03).
   103 77 DIG-1-MULT    PIC 9(03).
   104 77 DIG-2-MULT    PIC 9(03).
   105 77 DIG-3-MULT    PIC 9(03).
   106 77 DIG-4-MULT    PIC 9(03).
   107 77 DIG-5-MULT    PIC 9(03).
   108 77 DIG-6-MULT    PIC 9(03).
   109 77 DIG-7-MULT    PIC 9(03).
   110 77 DIG-8-MULT    PIC 9(03).
   111 77 DIG-9-MULT    PIC 9(03).
   112 77 DIG-V1-CORRET-MULT PIC 9(03).
   113
   114 01 CAB-01.
   115    02 FILLER      PIC X(31) VALUE SPACES.
* Microsoft COBOL Version 4.5        L2.4 revision 002 26-Sep-13 13:48 Page   3
*                                       EX06.CBL
   116    02 FILLER      PIC X(17) VALUE "TURISMAR TURISMOS".
   117    02 FILLER      PIC X(32) VALUE SPACES.
   118
   119 01 CAB-02.
   120    02 FILLER    PIC X(17) VALUE SPACES.
   121    02 FILLER    PIC X(45)
   122            VALUE "RELATÓRIO DE DADOS DE CLIENTES INCONSISTENTES".
   123    02 FILLER    PIC X(18)  VALUE SPACES.
   124
   125 01 CAB-03.
   126    02 FILLER      PIC X(17) VALUE "CÓDIGO DO CLIENTE".
   127    02 FILLER      PIC X(15) VALUE SPACES.
   128    02 FILLER      PIC X(15) VALUE "DADOS INVÁLIDOS".
   129    02 FILLER      PIC X(33) VALUE SPACES.
   130
   131 01 CAB-04.
   132    02 FILLER      PIC X(80) VALUE ALL '-'.
   133
   134 01 CAB-05.
   135    02 FILLER         PIC X(23)  VALUE SPACES.
   136
   137 01 CAB-06.
   138    02 FILLER         PIC X(12)  VALUE "CPF INVÁLIDO".
   139
   140 01 CAB-07.
   141    02 FILLER         PIC X(18)  VALUE "NOME NÃO INFORMADO".
   142
   143 01 CAB-08.
   144    02 FILLER         PIC X(15)  VALUE "ESTADO INVÁLIDO".
   145
   146 01 CAB-09.
   147    02 FILLER         PIC X(20)  VALUE "CIDADE NÃO INFORMADA".
   148
   149 01 CAB-10.
   150    02 FILLER         PIC X(19)  VALUE "EMAIL SEM DESCRIÇÃO".
   151
   152 01 CAB-11.
   153    02 FILLER         PIC X(13)  VALUE "DATA INVÁLIDA".
   154
   155 01 DETALHE.
   156    02 FILLER         PIC X(05)  VALUE SPACES.
   157    02 CODIGO-CLI     PIC ZZZ.
   158    02 FILLER         PIC X(25)  VALUE SPACES.
   159    02 MENSAGEM-ERRO  PIC X(47).
   160
   161 PROCEDURE DIVISION.
   162
   163 PROGRAMA05.
   164
   165 PERFORM INICIO.
   166 PERFORM PRINCIPAL UNTIL FIM-ARQ EQUAL 1.
   167 PERFORM TERMINO.
   168
   169 STOP RUN.
   170
   171 INICIO.
   172     OPEN INPUT CADCLI OUTPUT CADOK RELOCOR.
   173     PERFORM VERIFICA-FIM.
* Microsoft COBOL Version 4.5        L2.4 revision 002 26-Sep-13 13:48 Page   4
*                                       EX06.CBL
   174 VERIFICA-FIM.
   175     READ CADCLI AT END MOVE 1 TO FIM-ARQ.
   176 TERMINO.
   177     CLOSE CADCLI CADOK RELOCOR.
   178 PRINCIPAL.
   179     PERFORM CONSISTENCIA.
   180     PERFORM IMPRESSAO.
   181     PERFORM VERIFICA-FIM.
   182 GRAVA-REGOK.
   183     MOVE CPF      TO CPF-OK.
   184     MOVE NOME     TO NOME-OK.
   185     MOVE ESTADO   TO ESTADO-OK.
   186     MOVE CIDADE   TO CIDADE-OK.
   187     MOVE EMAIL    TO EMAIL-OK.
   188     MOVE TELEFONE TO TELEFONE-OK.
   189     MOVE DATA-ENT TO DATA-OK.
   190     WRITE REGOK.
   191 CONSISTENCIA.
   192     MOVE 0 TO ERRO.
   193     MOVE 0 TO ERRO-CPF.
   194     MOVE 0 TO ERRO-NOME.
   195     MOVE 0 TO ERRO-ESTADO.
   196     MOVE 0 TO ERRO-CIDADE.
   197     MOVE 0 TO ERRO-EMAIL.
   198     MOVE 0 TO ERRO-DATA.
   199     PERFORM VAL-ESTADO.
   200     PERFORM VAL-NOME.
   201     PERFORM VAL-CPF.
   202     PERFORM VAL-CIDADE.
   203     PERFORM VAL-EMAIL.
   204     PERFORM VAL-DATA.
   205 IMPRESSAO.
   206     IF ERRO EQUAL 0
   207        PERFORM GRAVA-REGOK
   208     ELSE
   209        IF CT-LIN GREATER THAN 40
   210           PERFORM CABECALHO
   211        END-IF
   212        PERFORM IMPDET
   213     END-IF.
   214
   215 IMPDET.
   216     MOVE CODIGO TO CODIGO-CLI.
   217     IF ERRO-NOME EQUAL 1
   218        MOVE CAB-07 TO MENSAGEM-ERRO
   219        MOVE 0 TO ERRO-NOME
   220     ELSE
   221        IF ERRO-ESTADO EQUAL 1
   222           MOVE CAB-08 TO MENSAGEM-ERRO
   223           MOVE 0 TO ERRO-ESTADO
   224        ELSE
   225           IF ERRO-CIDADE EQUAL 1
   226              MOVE CAB-09 TO MENSAGEM-ERRO
   227              MOVE 0 TO ERRO-CIDADE
   228           ELSE
   229              IF ERRO-EMAIL EQUAL 1
   230                 MOVE CAB-10 TO MENSAGEM-ERRO
   231                 MOVE 0 TO ERRO-EMAIL
* Microsoft COBOL Version 4.5        L2.4 revision 002 26-Sep-13 13:48 Page   5
*                                       EX06.CBL
   232              ELSE
   233                 IF ERRO-DATA EQUAL 1
   234                    MOVE CAB-11 TO MENSAGEM-ERRO
   235                    MOVE 0 TO ERRO-DATA
   236                 ELSE
   237                    MOVE CAB-06 TO MENSAGEM-ERRO
   238                    MOVE 0 TO ERRO-CPF
   239                 END-IF
   240              END-IF
   241           END-IF
   242        END-IF
   243     END-IF
   244
   245     WRITE REG-ATR FROM DETALHE AFTER ADVANCING 2 LINES.
   246     ADD 1 TO CT-LIN.
   247     IF CT-LIN GREATER THAN 40  GO TO PRINCIPAL.
   248     MOVE ZEROES TO CODIGO-CLI.
   249
   250     IF ERRO-NOME EQUAL 1
   251        MOVE CAB-07 TO MENSAGEM-ERRO
   252        WRITE REG-ATR FROM DETALHE AFTER ADVANCING 1 LINE
   253        ADD 1 TO CT-LIN
   254        IF CT-LIN GREATER THAN 40  GO TO PRINCIPAL
   255     END-IF.
   256
   257     IF ERRO-ESTADO EQUAL 1
   258        MOVE CAB-08 TO MENSAGEM-ERRO
   259        WRITE REG-ATR FROM DETALHE AFTER ADVANCING 1 LINE
   260        ADD 1 TO CT-LIN
   261        IF CT-LIN GREATER THAN 40  GO TO PRINCIPAL
   262     END-IF.
   263
   264     IF ERRO-CIDADE EQUAL 1
   265        MOVE CAB-09 TO MENSAGEM-ERRO
   266        WRITE REG-ATR FROM DETALHE AFTER ADVANCING 1 LINE
   267        ADD 1 TO CT-LIN
   268        IF CT-LIN GREATER THAN 40  GO TO PRINCIPAL
   269     END-IF.
   270
   271     IF ERRO-EMAIL EQUAL 1
   272        MOVE CAB-10 TO MENSAGEM-ERRO
   273        WRITE REG-ATR FROM DETALHE AFTER ADVANCING 1 LINE
   274        ADD 1 TO CT-LIN
   275        IF CT-LIN GREATER THAN 40  GO TO PRINCIPAL
   276     END-IF.
   277
   278     IF ERRO-DATA EQUAL 1
   279        MOVE CAB-11 TO MENSAGEM-ERRO
   280        WRITE REG-ATR FROM DETALHE AFTER ADVANCING 1 LINE
   281        ADD 1 TO CT-LIN
   282        IF CT-LIN GREATER THAN 40  GO TO PRINCIPAL
   283     END-IF.
   284
   285     IF ERRO-CPF EQUAL 1
   286        MOVE CAB-06 TO MENSAGEM-ERRO
   287        WRITE REG-ATR FROM DETALHE AFTER ADVANCING 1 LINE
   288        ADD 1 TO CT-LIN
   289     END-IF.
* Microsoft COBOL Version 4.5        L2.4 revision 002 26-Sep-13 13:48 Page   6
*                                       EX06.CBL
   290 CABECALHO.
   291     WRITE REG-ATR FROM CAB-01 AFTER ADVANCING PAGE.
   292     WRITE REG-ATR FROM CAB-02 AFTER ADVANCING 2 LINES.
   293     WRITE REG-ATR FROM CAB-03 AFTER ADVANCING 2 LINES.
   294     WRITE REG-ATR FROM CAB-04 AFTER ADVANCING 1 LINE.
   295     MOVE 1 TO CT-LIN.
   296 VAL-NOME.
   297     IF NOME EQUAL SPACES
   298        MOVE 1 TO ERRO
   299        MOVE 1 TO ERRO-NOME
   300     END-IF.
   301 VAL-ESTADO.
   302     IF NOT ESTADO-VALIDO
   303        MOVE 1 TO ERRO
   304        MOVE 1 TO ERRO-ESTADO
   305     END-IF.
   306 VAL-CIDADE.
   307     IF CIDADE EQUAL SPACES
   308        MOVE 1 TO ERRO
   309        MOVE 1 TO ERRO-CIDADE
   310     END-IF.
   311 VAL-EMAIL.
   312     IF EMAIL EQUAL SPACES
   313        MOVE 1 TO ERRO
   314        MOVE 1 TO ERRO-EMAIL
   315     END-IF.
   316 VAL-DATA.
   317     IF NOT DIA-VALIDO OR NOT MES-VALIDO
   318        MOVE 1 TO ERRO
   319        MOVE 1 TO ERRO-DATA
   320     ELSE
   321        IF MES-COM-30-DIAS AND DD GREATER THAN 30 OR
   322           MES-COM-31-DIAS AND DD GREATER THAN 31
   323           MOVE 1 TO ERRO
   324           MOVE 1 TO ERRO-DATA
   325        ELSE
   326           IF MM EQUAL 2 AND DD GREATER THAN 29
   327              MOVE 1 TO ERRO
   328              MOVE 1 TO ERRO-DATA
   329           ELSE
   330              IF DD EQUAL 29 AND MM EQUAL 2
   331                 DIVIDE AA BY 4 GIVING RESTO REMAINDER RESTO
   332                 IF RESTO NOT EQUAL 0
   333                    MOVE 1 TO ERRO
   334                    MOVE 1 TO ERRO-DATA
   335                 ELSE
   336                    DIVIDE AA BY 100 GIVING RESTO REMAINDER RESTO
   337                    IF RESTO EQUAL 0
   338                       MOVE 1 TO ERRO
   339                       MOVE 1 TO ERRO-DATA
   340                    END-IF
   341                 END-IF
   342              END-IF
   343           END-IF
   344        END-IF
   345     END-IF.
   346 VAL-CPF.
   347
* Microsoft COBOL Version 4.5        L2.4 revision 002 26-Sep-13 13:48 Page   7
*                                       EX06.CBL
   348     MULTIPLY 10 BY DIG-1 GIVING DIG-1-MULT.
   349     MULTIPLY 09 BY DIG-2 GIVING DIG-2-MULT.
   350     MULTIPLY 08 BY DIG-3 GIVING DIG-3-MULT.
   351     MULTIPLY 07 BY DIG-4 GIVING DIG-4-MULT.
   352     MULTIPLY 06 BY DIG-5 GIVING DIG-5-MULT.
   353     MULTIPLY 05 BY DIG-6 GIVING DIG-6-MULT.
   354     MULTIPLY 04 BY DIG-7 GIVING DIG-7-MULT.
   355     MULTIPLY 03 BY DIG-8 GIVING DIG-8-MULT.
   356     MULTIPLY 02 BY DIG-9 GIVING DIG-9-MULT.
   357
   358     ADD DIG-1-MULT DIG-2-MULT DIG-3-MULT
   359         DIG-4-MULT DIG-5-MULT DIG-6-MULT
   360         DIG-7-MULT DIG-8-MULT DIG-9-MULT GIVING DIG-1-MULT.
   361
   362     DIVIDE DIG-1-MULT BY 11 GIVING RESTO REMAINDER RESTO.
   363
   364     IF RESTO LESS THAN 2
   365        MOVE 0 TO DIG-V1-CORRET
   366     ELSE
   367        SUBTRACT RESTO FROM 11 GIVING DIG-V1-CORRET
   368     END-IF
   369
   370     MULTIPLY 11 BY DIG-1 GIVING DIG-1-MULT.
   371     MULTIPLY 10 BY DIG-2 GIVING DIG-2-MULT.
   372     MULTIPLY 09 BY DIG-3 GIVING DIG-3-MULT.
   373     MULTIPLY 08 BY DIG-4 GIVING DIG-4-MULT.
   374     MULTIPLY 07 BY DIG-5 GIVING DIG-5-MULT.
   375     MULTIPLY 06 BY DIG-6 GIVING DIG-6-MULT.
   376     MULTIPLY 05 BY DIG-7 GIVING DIG-7-MULT.
   377     MULTIPLY 04 BY DIG-8 GIVING DIG-8-MULT.
   378     MULTIPLY 03 BY DIG-9 GIVING DIG-9-MULT.
   379     MULTIPLY 02 BY DIG-V1-CORRET GIVING DIG-V1-CORRET-MULT.
   380
   381     ADD DIG-1-MULT DIG-2-MULT DIG-3-MULT
   382         DIG-4-MULT DIG-5-MULT DIG-6-MULT
   383         DIG-7-MULT DIG-8-MULT DIG-9-MULT TO DIG-V1-CORRET-MULT.
   384
   385     DIVIDE DIG-V1-CORRET-MULT BY 11 GIVING RESTO REMAINDER RESTO.
   386
   387     IF RESTO LESS THAN 2
   388        MOVE 0 TO DIG-V2-CORRET
   389     ELSE
   390        SUBTRACT RESTO FROM 11 GIVING DIG-V2-CORRET
   391     END-IF
   392
   393     IF (DIG-V1 NOT EQUAL DIG-V1-CORRET) OR
   394        (DIG-V2 NOT EQUAL DIG-V2-CORRET)
   395        MOVE 1 TO ERRO
   396        MOVE 1 TO ERRO-CPF
   397     END-IF.
* Microsoft COBOL Version 4.5        L2.4 revision 002
* (C)Copyright Microsoft Corp 1984, 1991       URN AXUPA/MS0/000000
*                                              REF GNB-024050002A7
*
* Total Messages:     0
* Data:        2180     Code:        2453     Dictionary:        4574
