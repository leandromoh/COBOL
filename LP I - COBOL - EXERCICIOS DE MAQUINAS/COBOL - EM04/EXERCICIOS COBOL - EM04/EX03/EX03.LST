* Microsoft COBOL Version 4.5        L2.4 revision 002 26-Nov-13 10:57 Page   1
*                                        E.CBL
* Options: LIST(E.LST) ASMLIST(E.GRP)
     1 IDENTIFICATION DIVISION.
     2
     3 PROGRAM-ID.    EX03.
     4 AUTHOR.        LEANDRO FERNANDES & EDEL CORADI.
     5 INSTALLATION.  FATEC-SP.
     6 DATE-WRITTEN.  20/11/2013.
     7 DATE-COMPILED. 26-Nov-13 10:57.
     8 SECURITY.
     9
    10 ENVIRONMENT DIVISION.
    11
    12 CONFIGURATION SECTION.
    13 SOURCE-COMPUTER. IBM-PC.
    14 OBJECT-COMPUTER. IBM-PC.
    15 SPECIAL-NAMES.   DECIMAL-POINT IS COMMA.
    16
    17 INPUT-OUTPUT SECTION.
    18 FILE-CONTROL.
    19 SELECT CADMERC ASSIGN TO DISK ORGANIZATION IS LINE SEQUENTIAL.
    20 SELECT MOVMERC ASSIGN TO DISK ORGANIZATION IS LINE SEQUENTIAL.
    21 SELECT ATUMERC ASSIGN TO DISK ORGANIZATION IS LINE SEQUENTIAL.
    22 SELECT RELERRO ASSIGN TO DISK ORGANIZATION IS LINE SEQUENTIAL.
    23 SELECT RELMERC ASSIGN TO DISK ORGANIZATION IS LINE SEQUENTIAL.
    24
    25 DATA DIVISION.
    26
    27 FILE SECTION.
    28 FD CADMERC
    29   LABEL RECORD ARE STANDARD VALUE OF FILE-ID IS "CADMERC.DAT".
    30
    31 01 REG-CADMERC.
    32   02 CODIGO-CADMERC      PIC 9(03).
    33   02 DESCRICAO-CADMERC   PIC X(30).
    34   02 ESTOQ-MIN-CADMERC   PIC 9(03).
    35   02 QTD-ESTOQ-CADMERC   PIC 9(03).
    36   02 PRECO-UNIT-CADMERC  PIC 9(04)V9(02).
    37
    38 FD MOVMERC
    39   LABEL RECORD ARE STANDARD VALUE OF FILE-ID IS "MOVMERC.DAT".
    40
    41 01 REG-MOVMERC.
    42   02 CODIGO-MOVMERC           PIC 9(03).
    43   02 DESCRICAO-MOVMERC        PIC X(30).
    44   02 ESTOQ-MIN-MOVMERC        PIC 9(03).
    45   02 QTD-ESTOQ-MOVMERC        PIC 9(03).
    46   02 PRECO-UNIT-MOVMERC       PIC 9(04)V9(02).
    47   02 TIPO-ATUALIZACAO-MOVMERC PIC X(01).
    48
    49 FD ATUMERC
    50   LABEL RECORD ARE STANDARD VALUE OF FILE-ID IS "ATUMERC.DAT".
    51
    52 01 REG-ATUMERC.
    53   02 CODIGO-ATUMERC      PIC 9(03).
    54   02 DESCRICAO-ATUMERC   PIC X(30).
    55   02 ESTOQ-MIN-ATUMERC   PIC 9(03).
    56   02 QTD-ESTOQ-ATUMERC   PIC 9(03).
    57   02 PRECO-UNIT-ATUMERC  PIC 9(04)V9(02).
* Microsoft COBOL Version 4.5        L2.4 revision 002 26-Nov-13 10:57 Page   2
*                                        E.CBL
    58
    59 FD RELERRO
    60    LABEL RECORD IS OMITTED.
    61
    62 01 REL-ERRO              PIC X(80).
    63
    64 FD RELMERC
    65    LABEL RECORD IS OMITTED.
    66
    67 01 REL-MERC              PIC X(80).
    68
    69 WORKING-STORAGE SECTION.
    70
    71 77 CH-CADMERC           PIC X(04) VALUE SPACES.
    72 77 CH-MOVMERC           PIC X(04) VALUE SPACES.
    73 77 CT-PAG-RELERRO       PIC 9(03) VALUE 0.
    74 77 CT-PAG-RELMERC       PIC 9(03) VALUE 0.
    75 77 CT-LIN-RELERRO       PIC 9(02) VALUE 41.
    76 77 CT-LIN-RELMERC       PIC 9(02) VALUE 41.
    77
    78 01 CAB-01-RELERRO.
    79    02 FILLER            PIC X(29) VALUE SPACES.
    80    02 FILLER            PIC X(22) VALUE "RELAÇÃO DE MERCADORIAS".
    81    02 FILLER            PIC X(15) VALUE SPACES.
    82    02 FILLER            PIC X(05) VALUE "PAG. ".
    83    02 VAR-PAG-RELERRO   PIC ZZ9.
    84    02 FILLER            PIC X(06) VALUE SPACES.
    85
    86 01 CAB-02-RELERRO.
    87    02 FILLER            PIC X(30) VALUE SPACES.
    88    02 FILLER            PIC X(20) VALUE "ERROS DE ATUALIZACAO".
    89    02 FILLER            PIC X(30) VALUE SPACES.
    90
    91 01 CAB-03-RELERRO.
    92    02 FILLER            PIC X(03) VALUE SPACES.
    93    02 FILLER            PIC X(06) VALUE "CODIGO".
    94    02 FILLER            PIC X(10) VALUE SPACES.
    95    02 FILLER            PIC X(09) VALUE "DESCRIÇÀO".
    96    02 FILLER            PIC X(26) VALUE SPACES.
    97    02 FILLER            PIC X(08) VALUE "MENSAGEM".
    98    02 FILLER            PIC X(18) VALUE SPACES.
    99
   100 01 DETALHE-RELERRO.
   101    02 FILLER            PIC X(04) VALUE SPACES.
   102    02 CODIGO-RELERRO    PIC 999.
   103    02 FILLER            PIC X(04) VALUE SPACES.
   104    02 DESCRICAO-RELERRO PIC X(30).
   105    02 FILLER            PIC X(03) VALUE SPACES.
   106    02 MENSAGEM-RELERRO  PIC X(31).
   107    02 FILLER            PIC X(08) VALUE SPACES.
   108
   109 01 CAB-01-RELMERC.
   110    02 FILLER            PIC X(29) VALUE SPACES.
   111    02 FILLER            PIC X(22) VALUE "RELAÇÃO DE MERCADORIAS".
   112    02 FILLER            PIC X(15) VALUE SPACES.
   113    02 FILLER            PIC X(05) VALUE "PAG. ".
   114    02 VAR-PAG-RELMERC   PIC ZZ9.
   115    02 FILLER            PIC X(06) VALUE SPACES.
* Microsoft COBOL Version 4.5        L2.4 revision 002 26-Nov-13 10:57 Page   3
*                                        E.CBL
   116
   117 01 CAB-02-RELMERC.
   118    02 FILLER            PIC X(32) VALUE SPACES.
   119    02 FILLER            PIC X(15) VALUE "ESTOQUE CRÍTICO".
   120    02 FILLER            PIC X(32) VALUE SPACES.
   121
   122 01 CAB-03-RELMERC.
   123    02 FILLER            PIC X(02) VALUE SPACES.
   124    02 FILLER            PIC X(06) VALUE "CODIGO".
   125    02 FILLER            PIC X(04) VALUE SPACES.
   126    02 FILLER            PIC X(09) VALUE "DESCRIÇÀO".
   127    02 FILLER            PIC X(20) VALUE SPACES.
   128    02 FILLER            PIC X(07) VALUE "ESTOQUE".
   129    02 FILLER            PIC X(05) VALUE SPACES.
   130    02 FILLER            PIC X(10) VALUE "QUANTIDADE".
   131    02 FILLER            PIC X(06) VALUE SPACES.
   132    02 FILLER            PIC X(05) VALUE "PREÇO".
   133    02 FILLER            PIC X(06) VALUE SPACES.
   134
   135 01 CAB-04-RELMERC.
   136    02 FILLER            PIC X(42) VALUE SPACES.
   137    02 FILLER            PIC X(06) VALUE "MÍNIMO".
   138    02 FILLER            PIC X(06) VALUE SPACES.
   139    02 FILLER            PIC X(07) VALUE "ESTOQUE".
   140    02 FILLER            PIC X(07) VALUE SPACES.
   141    02 FILLER            PIC X(08) VALUE "UNITARIO".
   142    02 FILLER            PIC X(04) VALUE SPACES.
   143
   144 01 DETALHE-RELMERC.
   145    02 FILLER             PIC X(03) VALUE SPACES.
   146    02 CODIGO-RELMERC     PIC 999.
   147    02 FILLER             PIC X(02) VALUE SPACES.
   148    02 DESCRICAO-RELMERC  PIC X(30).
   149    02 FILLER             PIC X(06) VALUE SPACES.
   150    02 ESTOQ-MIN-RELMERC  PIC 999.
   151    02 FILLER             PIC X(09) VALUE SPACES.
   152    02 QTD-ESTOQ-RELMERC  PIC 999.
   153    02 FILLER             PIC X(09) VALUE SPACES.
   154    02 PRECO-UNIT-RELMERC PIC Z.Z99,99.
   155    02 FILLER             PIC X(04) VALUE SPACES.
   156
   157 PROCEDURE DIVISION.
   158
   159 PROGRAM03.
   160
   161 PERFORM INICIO.
   162 PERFORM PRINCIPAL UNTIL CH-CADMERC EQUAL CH-MOVMERC AND
   163                         CH-MOVMERC  EQUAL HIGH-VALUES.
   164 PERFORM FIM.
   165 STOP RUN.
   166
   167 INICIO.
   168        OPEN INPUT CADMERC MOVMERC OUTPUT ATUMERC RELERRO RELMERC.
   169        PERFORM LER-CADMERC.
   170        PERFORM LER-MOVMERC.
   171
   172 LER-CADMERC.
   173        READ CADMERC AT END MOVE HIGH-VALUES TO CH-CADMERC.
* Microsoft COBOL Version 4.5        L2.4 revision 002 26-Nov-13 10:57 Page   4
*                                        E.CBL
   174        IF CH-CADMERC EQUAL HIGH-VALUES
   175           NEXT SENTENCE
   176        ELSE
   177           MOVE CODIGO-CADMERC TO CH-CADMERC
   178        END-IF.
   179
   180 LER-MOVMERC.
   181        READ MOVMERC AT END MOVE HIGH-VALUES TO CH-MOVMERC.
   182        IF CH-MOVMERC EQUAL HIGH-VALUES
   183           NEXT SENTENCE
   184        ELSE
   185           MOVE CODIGO-MOVMERC TO CH-MOVMERC
   186        END-IF.
   187
   188 PRINCIPAL.
   189        IF CT-LIN-RELERRO GREATER THAN 40
   190           PERFORM CABECALHO-RELERRO
   191        END-IF
   192
   193        IF CT-LIN-RELMERC GREATER THAN 40
   194           PERFORM CABECALHO-RELMERC
   195        END-IF
   196*IGUAL
   197        IF CH-CADMERC EQUAL CH-MOVMERC
   198           IF TIPO-ATUALIZACAO-MOVMERC EQUAL "A"
   199              PERFORM GRAVA-MOVMERC
   200           END-IF
   201
   202           IF TIPO-ATUALIZACAO-MOVMERC EQUAL "I"
   203              MOVE CODIGO-MOVMERC     TO CODIGO-RELERRO
   204              MOVE DESCRICAO-MOVMERC  TO DESCRICAO-RELERRO
   205              MOVE "INCLUSÃO P/REG. JÁ EXISTENTE" TO
   206                                               MENSAGEM-RELERRO
   207              WRITE REL-ERRO FROM DETALHE-RELERRO AFTER
   208                                               ADVANCING 1 LINE
   209
   210              PERFORM GRAVA-CADMERC
   211           END-IF
   212
   213           PERFORM LER-CADMERC
   214           PERFORM LER-MOVMERC
   215        ELSE
   216*CADANT
   217           IF CH-CADMERC LESS CH-MOVMERC
   218              PERFORM GRAVA-CADMERC
   219              PERFORM LER-CADMERC
   220*CADMOV
   221           ELSE
   222              MOVE CODIGO-MOVMERC     TO CODIGO-RELERRO
   223              MOVE DESCRICAO-MOVMERC  TO DESCRICAO-RELERRO
   224
   225              IF TIPO-ATUALIZACAO-MOVMERC EQUAL "A"
   226                 MOVE "ALTERAÇÃO P/REG. INEXISTENTE"
   227                 TO MENSAGEM-RELERRO
   228              END-IF
   229
   230              IF TIPO-ATUALIZACAO-MOVMERC EQUAL "E"
   231                 MOVE "EXCLUSÃO P/REG. INEXISTENTE"
* Microsoft COBOL Version 4.5        L2.4 revision 002 26-Nov-13 10:57 Page   5
*                                        E.CBL
   232                 TO MENSAGEM-RELERRO
   233              END-IF
   234
   235              IF TIPO-ATUALIZACAO-MOVMERC EQUAL "I"
   236                 PERFORM GRAVA-MOVMERC
   237              ELSE
   238                 WRITE REL-ERRO FROM DETALHE-RELERRO AFTER
   239                                          ADVANCING 1 LINE
   240              END-IF
   241
   242              PERFORM LER-MOVMERC
   243           END-IF
   244        END-IF.
   245
   246 GRAVA-MOVMERC.
   247        MOVE CODIGO-MOVMERC     TO CODIGO-ATUMERC.
   248        MOVE DESCRICAO-MOVMERC  TO DESCRICAO-ATUMERC.
   249        MOVE ESTOQ-MIN-MOVMERC  TO ESTOQ-MIN-ATUMERC.
   250        MOVE QTD-ESTOQ-MOVMERC  TO QTD-ESTOQ-ATUMERC.
   251        MOVE PRECO-UNIT-MOVMERC TO PRECO-UNIT-ATUMERC.
   252        WRITE REG-ATUMERC.
   253        PERFORM CARIMBA-DETALHE-RELMERC.
   254
   255 GRAVA-CADMERC.
   256        MOVE CODIGO-CADMERC     TO CODIGO-ATUMERC.
   257        MOVE DESCRICAO-CADMERC  TO DESCRICAO-ATUMERC.
   258        MOVE ESTOQ-MIN-CADMERC  TO ESTOQ-MIN-ATUMERC.
   259        MOVE QTD-ESTOQ-CADMERC  TO QTD-ESTOQ-ATUMERC.
   260        MOVE PRECO-UNIT-CADMERC TO PRECO-UNIT-ATUMERC.
   261        WRITE REG-ATUMERC.
   262        PERFORM CARIMBA-DETALHE-RELMERC.
   263
   264 CARIMBA-DETALHE-RELMERC.
   265        IF QTD-ESTOQ-ATUMERC NOT GREATER THAN ESTOQ-MIN-ATUMERC
   266           MOVE CODIGO-ATUMERC     TO CODIGO-RELMERC
   267           MOVE DESCRICAO-ATUMERC  TO DESCRICAO-RELMERC
   268           MOVE ESTOQ-MIN-ATUMERC  TO ESTOQ-MIN-RELMERC
   269           MOVE QTD-ESTOQ-ATUMERC  TO QTD-ESTOQ-RELMERC
   270           MOVE PRECO-UNIT-ATUMERC TO PRECO-UNIT-RELMERC
   271           WRITE REL-MERC FROM DETALHE-RELMERC
   272           ADD 1 TO CT-LIN-RELMERC
   273        END-IF.
   274
   275 FIM.
   276        CLOSE CADMERC MOVMERC ATUMERC RELERRO RELMERC.
   277
   278 CABECALHO-RELERRO.
   279        ADD 1 TO CT-PAG-RELERRO.
   280        MOVE CT-PAG-RELERRO TO VAR-PAG-RELERRO.
   281        MOVE 0 TO CT-LIN-RELERRO.
   282        MOVE SPACES TO REL-ERRO.
   283        WRITE REL-ERRO AFTER ADVANCING PAGE.
   284        WRITE REL-ERRO FROM CAB-01-RELERRO
   285                               AFTER ADVANCING 1 LINE.
   286        WRITE REL-ERRO FROM CAB-02-RELERRO
   287                               AFTER ADVANCING 2 LINES.
   288        WRITE REL-ERRO FROM CAB-03-RELERRO
   289                               AFTER ADVANCING 2 LINES.
* Microsoft COBOL Version 4.5        L2.4 revision 002 26-Nov-13 10:57 Page   6
*                                        E.CBL
   290        MOVE SPACES TO REL-ERRO.
   291        WRITE REL-ERRO AFTER ADVANCING 1 LINE.
   292
   293 CABECALHO-RELMERC.
   294        ADD 1 TO CT-PAG-RELMERC.
   295        MOVE CT-PAG-RELMERC TO VAR-PAG-RELMERC.
   296        MOVE 0 TO CT-LIN-RELMERC.
   297        MOVE SPACES TO REL-MERC.
   298        WRITE REL-MERC AFTER ADVANCING PAGE.
   299        WRITE REL-MERC FROM CAB-01-RELMERC
   300                               AFTER ADVANCING 1 LINE.
   301        WRITE REL-MERC FROM CAB-02-RELMERC
   302                               AFTER ADVANCING 2 LINES.
   303        WRITE REL-MERC FROM CAB-03-RELMERC
   304                               AFTER ADVANCING 2 LINES.
   305        WRITE REL-MERC FROM CAB-04-RELMERC
   306                               AFTER ADVANCING 1 LINE.
   307        MOVE SPACES TO REL-MERC.
   308        WRITE REL-MERC AFTER ADVANCING 1 LINE.
* Microsoft COBOL Version 4.5        L2.4 revision 002
* (C)Copyright Microsoft Corp 1984, 1991       URN AXUPA/MS0/000000
*                                              REF GNB-024050002A7
*
* Total Messages:     0
* Data:        2572     Code:        1561     Dictionary:        3715
