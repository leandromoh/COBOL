* Microsoft COBOL Version 4.5        L2.4 revision 002 30-Oct-13 05:41 Page   1
*                                        E.CBL
* Options: LIST(E.LST) ASMLIST(E.GRP)
     1 IDENTIFICATION DIVISION.
     2
     3 PROGRAM-ID.   EX04.
     4 AUTHOR.       LEANDRO & EDEL.
     5 INSTALLATION. FATEC-SP.
     6 DATE-WRITTEN. 19/10/13.
     7 DATE-COMPILED. 30-Oct-13 05:41.
     8 SECURITY.
     9
    10 ENVIRONMENT DIVISION.
    11
    12 CONFIGURATION SECTION.
    13 SOURCE-COMPUTER. IBM-PC.
    14 OBJECT-COMPUTER. IBM-PC.
    15 SPECIAL-NAMES.   DECIMAL-POINT IS COMMA.
    16
    17 INPUT-OUTPUT SECTION.
    18 FILE-CONTROL.
    19 SELECT CAD-CLI ASSIGN TO DISK ORGANIZATION IS LINE SEQUENTIAL.
    20 SELECT REL-GRL ASSIGN TO DISK.
    21 SELECT TRAB    ASSIGN TO DISK.
    22
    23 DATA DIVISION.
    24 FILE SECTION.
    25
    26 FD CAD-CLI
    27   LABEL RECORD ARE STANDARD VALUE OF FILE-ID IS "CAD-CLI.DAT".
    28
    29 01 REG-ENT.
    30   02 CODIGO-ENT    PIC 9(03).
    31   02 CPF-ENT       PIC 9(11).
    32   02 NOME-ENT      PIC X(30).
    33   02 ESTADO-ENT    PIC X(02).
    34   02 CIDADE-ENT    PIC X(30).
    35   02 EMAIL-ENT     PIC X(30).
    36
    37 SD TRAB.
    38
    39 01 REG-TRAB.
    40   02 CODIGO-TRAB    PIC 9(03).
    41   02 CPF-TRAB       PIC 9(11).
    42   02 NOME-TRAB      PIC X(30).
    43   02 ESTADO-TRAB    PIC X(02).
    44   02 CIDADE-TRAB    PIC X(30).
    45   02 EMAIL-TRAB     PIC X(30).
    46
    47 FD REL-GRL
    48   LABEL RECORD IS OMITTED.
    49
    50 01 REG-ATR          PIC X(80).
    51
    52 WORKING-STORAGE SECTION.
    53
    54 77 FIM-ARQ       PIC 9(01) VALUE 0.
    55 77 CT-PAG        PIC 9(02) VALUE 0.
    56 77 CT-LIN        PIC 9(02) VALUE 21.
    57 77 ESTADO-ATUAL  PIC X(02).
* Microsoft COBOL Version 4.5        L2.4 revision 002 30-Oct-13 05:41 Page   2
*                                        E.CBL
    58 77 CIDADE-ATUAL  PIC X(30).
    59 77 FLAG-1        PIC 9(01) VALUE 1.
    60
    61 01 CAB-01.
    62   02 FILLER      PIC X(23) VALUE SPACES.
    63   02 FILLER      PIC X(37) VALUE
    64    "RELAÇÃO DE CLIENTES POR ESTADO/CIDADE".
    65   02 FILLER      PIC X(05) VALUE SPACES.
    66   02 FILLER      PIC X(05) VALUE "PAG. ".
    67   02 VAR-PAG     PIC ZZ9.
    68   02 FILLER      PIC X(07) VALUE SPACES.
    69
    70 01 CAB-02.
    71   02 FILLER      PIC X(08) VALUE "ESTADO: ".
    72   02 ESTADO-REL  PIC X(02).
    73   02 FILLER      PIC X(70) VALUE SPACES.
    74
    75 01 CAB-03.
    76   02 FILLER      PIC X(08) VALUE "CIDADE: ".
    77   02 CIDADE-REL  PIC X(30).
    78   02 FILLER      PIC X(42) VALUE SPACES.
    79
    80 01 CAB-04.
    81   02 FILLER      PIC X(03) VALUE "CPF".
    82   02 FILLER      PIC X(24) VALUE SPACES.
    83   02 FILLER      PIC X(04) VALUE "NOME".
    84   02 FILLER      PIC X(20) VALUE SPACES.
    85   02 FILLER      PIC X(06) VALUE "E-MAIL".
    86   02 FILLER      PIC X(23) VALUE SPACES.
    87
    88 01 DETALHE.
    89   02 CPF-REL     PIC X(14) VALUE "999.999.999-99".
    90   02 FILLER      PIC X(03) VALUE SPACES.
    91   02 NOME-REL    PIC X(30).
    92   02 FILLER      PIC X(03) VALUE SPACES.
    93   02 EMAIL-REL   PIC X(30).
    94
    95 PROCEDURE DIVISION.
    96
    97 PROGRAM04.
    98
    99 SORT TRAB
   100      ASCENDING KEY ESTADO-TRAB
   101      ASCENDING KEY CIDADE-TRAB
   102      ASCENDING KEY CPF-TRAB
   103      USING CAD-CLI
   104      OUTPUT PROCEDURE GERA-REL.
   105
   106 STOP RUN.
   107
   108 INICIO.
   109        OPEN INPUT CAD-CLI OUTPUT REL-GRL.
   110        PERFORM VERIFICA-FIM.
   111
   112 VERIFICA-FIM.
   113        RETURN TRAB AT END MOVE 1 TO FIM-ARQ.
   114
   115 FIM.
* Microsoft COBOL Version 4.5        L2.4 revision 002 30-Oct-13 05:41 Page   3
*                                        E.CBL
   116        CLOSE CAD-CLI REL-GRL.
   117
   118 AVANCA-PAGINA.
   119        ADD  1 TO CT-PAG.
   120        MOVE 0 TO CT-LIN.
   121        MOVE SPACES TO REG-ATR.
   122        WRITE REG-ATR AFTER ADVANCING PAGE.
   123
   124 PRINCIPAL.
   125        IF ESTADO-ATUAL NOT EQUAL ESTADO-TRAB
   126           MOVE ESTADO-TRAB  TO ESTADO-ATUAL
   127           MOVE ESTADO-ATUAL TO ESTADO-REL
   128           PERFORM AVANCA-PAGINA
   129           PERFORM CABECALHO-ESTADO
   130        END-IF
   131
   132        IF CIDADE-ATUAL NOT EQUAL CIDADE-TRAB
   133           MOVE CIDADE-TRAB  TO CIDADE-ATUAL
   134           MOVE CIDADE-ATUAL TO CIDADE-REL
   135           PERFORM CABECALHO-CIDADE
   136        END-IF
   137
   138        PERFORM IMPRESSAO.
   139        PERFORM VERIFICA-FIM.
   140
   141 IMPRESSAO.
   142        IF CT-LIN GREATER THAN 20
   143           PERFORM AVANCA-PAGINA
   144        END-IF
   145        PERFORM IMPDET.
   146
   147 IMPDET.
   148        MOVE CPF-TRAB(1:3)  TO CPF-REL(1:3).
   149        MOVE CPF-TRAB(4:3)  TO CPF-REL(5:3).
   150        MOVE CPF-TRAB(7:3)  TO CPF-REL(9:3).
   151        MOVE CPF-TRAB(10:2) TO CPF-REL(13:2).
   152        MOVE NOME-TRAB  TO NOME-REL.
   153        MOVE EMAIL-TRAB TO EMAIL-REL.
   154        WRITE REG-ATR FROM DETALHE AFTER ADVANCING 1 LINE.
   155        ADD 1 TO CT-LIN.
   156
   157 CABECALHO-ESTADO.
   158        MOVE CT-PAG TO VAR-PAG.
   159        WRITE REG-ATR FROM CAB-01 AFTER ADVANCING 1 LINE.
   160        WRITE REG-ATR FROM CAB-02 AFTER ADVANCING 2 LINES.
   161
   162 CABECALHO-CIDADE.
   163        WRITE REG-ATR FROM CAB-03 AFTER ADVANCING 2 LINES.
   164        WRITE REG-ATR FROM CAB-04 AFTER ADVANCING 2 LINES.
   165        MOVE SPACES TO REG-ATR.
   166        WRITE REG-ATR AFTER ADVANCING 1 LINE.
   167
   168 GERA-REL SECTION.
   169        PERFORM INICIO.
   170        PERFORM PRINCIPAL UNTIL FIM-ARQ EQUAL 1.
   171        PERFORM FIM.
* Microsoft COBOL Version 4.5        L2.4 revision 002
* (C)Copyright Microsoft Corp 1984, 1991       URN AXUPA/MS0/000000
* Microsoft COBOL Version 4.5        L2.4 revision 002 30-Oct-13 05:41 Page   4
*                                        E.CBL
*                                              REF GNB-024050002A7
*
* Total Messages:     0
* Data:        1924     Code:         911     Dictionary:        2485
